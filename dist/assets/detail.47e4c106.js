import{a as G,u as J,b as ie,o as se,c as oe,r as de,d as Q,I as Z,_ as K}from"./index.2db16e7d.js";import{g as U,h as m,s as F,V as ce,E as Y,i as a,G as ue,z as fe,S as ve,W as he,l as ge,J as me,X as _e,o as E,m as N,v as t,q as l,w as V,t as C,H as $,M as pe,N as xe,c as ke,F as be,n as we}from"./vendor.f7f2557a.js";import{_ as ye}from"./index.cf012bec.js";import{u as Ce}from"./use-placeholder.32ea2fae.js";import{c as W,m as z,f as Te,t as ee,u as q,w as X,n as Be,I as L,g as Ie,j as Se}from"./index.d8a3e501.js";import{a as Re}from"./constant.8dd07f23.js";import{u as Ee,a as Le,L as Ne}from"./use-tab-status.8b7202fc.js";import{S as ae}from"./index.f03662b3.js";var[De,D,je]=W("list"),Pe={error:Boolean,offset:z(300),loading:Boolean,finished:Boolean,errorText:String,direction:Te("down"),loadingText:String,finishedText:String,immediateCheck:ee},Ae=U({name:De,props:Pe,emits:["load","update:error","update:loading"],setup(e,{emit:_,slots:r}){var v=m(!1),i=m(),p=m(),f=Ee(),k=Le(i),n=()=>{ue(()=>{if(!(v.value||e.finished||e.error||(f==null?void 0:f.value)===!1)){var{offset:c,direction:w}=e,g=q(k);if(!(!g.height||ie(i))){var o=!1,x=q(p);w==="up"?o=g.top-x.top<=c:o=x.bottom-g.bottom<=c,o&&(v.value=!0,_("update:loading",!0),_("load"))}}})},b=()=>{if(e.finished){var c=r.finished?r.finished():e.finishedText;if(c)return a("div",{class:D("finished-text")},[c])}},h=()=>{_("update:error",!1),n()},B=()=>{if(e.error){var c=r.error?r.error():e.errorText;if(c)return a("div",{class:D("error-text"),onClick:h},[c])}},I=()=>{if(v.value&&!e.finished)return a("div",{class:D("loading")},[r.loading?r.loading():a(Ne,{class:D("loading-icon")},{default:()=>[e.loadingText||je("loading")]})])};return F([()=>e.loading,()=>e.finished,()=>e.error],n),f&&F(f,c=>{c&&n()}),ce(()=>{v.value=e.loading}),Y(()=>{e.immediateCheck&&n()}),G({check:n}),J("scroll",n,{target:k}),()=>{var c=r.default==null?void 0:r.default(),w=a("div",{ref:p,class:D("placeholder")},null);return a("div",{ref:i,role:"feed",class:D(),"aria-busy":v.value},[e.direction==="down"?c:w,I(),b(),B(),e.direction==="up"?c:w])}}}),Oe=X(Ae),[Ue,T]=W("nav-bar"),Fe=U({name:Ue,props:{title:String,fixed:Boolean,zIndex:Be,border:ee,leftText:String,rightText:String,leftArrow:Boolean,placeholder:Boolean,safeAreaInsetTop:Boolean},emits:["click-left","click-right"],setup(e,{emit:_,slots:r}){var v=m(),i=Ce(v,T),p=h=>_("click-left",h),f=h=>_("click-right",h),k=()=>r.left?r.left():[e.leftArrow&&a(L,{class:T("arrow"),name:"arrow-left"},null),e.leftText&&a("span",{class:T("text")},[e.leftText])],n=()=>r.right?r.right():a("span",{class:T("text")},[e.rightText]),b=()=>{var{title:h,fixed:B,border:I,zIndex:c}=e,w=Ie(c),g=e.leftArrow||e.leftText||r.left,o=e.rightText||r.right;return a("div",{ref:v,style:w,class:[T({fixed:B,"safe-area-inset-top":e.safeAreaInsetTop}),{[Re]:I}]},[a("div",{class:T("content")},[g&&a("div",{class:T("left"),onClick:p},[k()]),a("div",{class:[T("title"),"van-ellipsis"]},[r.title?r.title():h]),o&&a("div",{class:T("right"),onClick:f},[n()])])])};return()=>e.fixed&&e.placeholder?i(b):b()}}),$e=X(Fe),[qe,P]=W("notice-bar"),He={text:String,mode:String,color:String,delay:z(1),speed:z(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}},Me=U({name:qe,props:He,emits:["close","replay"],setup(e,{emit:_,slots:r}){var v=0,i=0,p,f=m(),k=m(),n=fe({show:!0,offset:0,duration:0}),b=()=>{if(r["left-icon"])return r["left-icon"]();if(e.leftIcon)return a(L,{class:P("left-icon"),name:e.leftIcon},null)},h=()=>{if(e.mode==="closeable")return"cross";if(e.mode==="link")return"arrow"},B=o=>{e.mode==="closeable"&&(n.show=!1,_("close",o))},I=()=>{if(r["right-icon"])return r["right-icon"]();var o=h();if(o)return a(L,{name:o,class:P("right-icon"),onClick:B},null)},c=()=>{n.offset=v,n.duration=0,de(()=>{Q(()=>{n.offset=-i,n.duration=(i+v)/+e.speed,_("replay")})})},w=()=>{var o=e.scrollable===!1&&!e.wrapable,x={transform:n.offset?"translateX("+n.offset+"px)":"",transitionDuration:n.duration+"s"};return a("div",{ref:f,role:"marquee",class:P("wrap")},[a("div",{ref:k,style:x,class:[P("content"),{"van-ellipsis":o}],onTransitionend:c},[r.default?r.default():e.text])])},g=()=>{var{delay:o,speed:x,scrollable:y}=e,H=Se(o)?+o*1e3:0;v=0,i=0,n.offset=0,n.duration=0,clearTimeout(p),p=setTimeout(()=>{if(!(!f.value||!k.value||y===!1)){var A=q(f).width,O=q(k).width;(y||O>A)&&Q(()=>{v=A,i=O,n.offset=-i,n.duration=i/+x})}},H)};return se(g),oe(g),J("pageshow",g),G({reset:g}),F(()=>[e.text,e.scrollable],g),()=>{var{color:o,wrapable:x,background:y}=e;return ve(a("div",{role:"alert",class:P({wrapable:x}),style:{color:o,background:y}},[b(),w(),I()]),[[he,n.show]])}}}),te=X(Me);const Ve=e=>(pe("data-v-72d8f8db"),e=e(),xe(),e),We={class:"songDetail"},ze={class:"header"},Xe={class:"main"},Ge={class:"main-header"},Je={key:0},Qe={class:"playListHeader"},Ze={class:"coverImg"},Ke={class:"pl-right"},Ye={class:"creator"},ea={class:"creatorImg"},aa={class:"creatorName"},ta={class:"description"},ra=Ve(()=>t("span",{class:"description-name"},"\u7B80\u4ECB:",-1)),na={class:"header-util"},la={class:"main-list"},ia={class:"song-content"},sa={class:"song-list"},oa=["onClick"],da={class:"song-index"},ca={class:"song-item-right"},ua={class:"song-name"},fa={key:0},va={class:"singer"},ha={key:0,class:"sq"},ga=U({setup(e){const _=ge(),r=me();let v={coverImgUrl:"",name:"",description:"",playCount:0,shareCount:"",commentCount:"",creator:{backgroundUrl:"",nickname:""}},i=m(v),p={id:""},f=m(!0),k=m(!0),n=m([]),b=m("\u6B4C\u5355"),h=m({});const B=async s=>{const u=await K.get({url:"/playlist/detail",data:{id:s}}),{playlist:d}=u,{coverImgUrl:S,name:R,creator:j,description:M,playCount:re,commentCount:ne,shareCount:le}=d;return i.value={coverImgUrl:S,commentCount:ne,name:R,creator:j,description:M,shareCount:le,playCount:re},f.value=!1,d},I=async s=>s.length<1?void 0:await K.get({url:"/song/detail",data:{ids:s}}),c=s=>{let u=[];return s.forEach(d=>{u.push(d.id)}),u.join(",")},w=(s,u)=>{let d=0,S=0,R=[],j={};return s.forEach(M=>{d++,R.push(M),d===u&&(d=0,j[S]=R,S++,R=[])}),j[S]=R,j},g=async s=>{const u=await B(s);h.value=w(u.trackIds,20)},o=m(!1),x=m(!1);let y=0;const H=async()=>{const s=Object.keys(h.value).length,u=c(h.value[y]),{songs:d}=await I(u);n.value=[...n.value,...d],o.value=!1,console.log(y),y++,y===s-1&&(x.value=!0)},A=()=>{f.value=!0,k.value=!0,i.value=v,n.value=[],o.value=!0,x.value=!1,y=0,b.value="\u6B4C\u5355"};F(()=>_.params,(s,u)=>{if(!(_.path.indexOf("/playlist/detail/")<0)){if((p==null?void 0:p.id)===(s==null?void 0:s.id)){f.value=!1,k.value=!1;return}A(),g(s.id)}}),_e((s,u)=>{p=u.params}),Y(()=>{const s=document.querySelector(".main");console.log(s.scrollTop),s.addEventListener("scroll",()=>{const u=s.scrollTop;console.log(s.scrollTop),u>=120?b.value=i.value.name:b.value="\u6B4C\u5355"})}),g(_.params.id);const O=()=>{r.back()};return(s,u)=>(E(),N("div",We,[t("div",ze,[a(l($e),{"left-arrow":"",onClickLeft:O},{title:V(()=>[a(l(te),{text:l(b)},null,8,["text"])]),_:1})]),t("div",Xe,[t("div",Ge,[a(l(ae),{title:"",avatar:"","avatar-size":"100px",row:4,loading:l(f)},null,8,["loading"]),l(f)?$("",!0):(E(),N("div",Je,[t("div",Qe,[t("div",Ze,[a(l(Z),{width:"100%",height:"100%",src:l(i).coverImgUrl},null,8,["src"])]),t("div",Ke,[t("h1",null,C(l(i).name),1),t("div",Ye,[t("div",ea,[a(l(Z),{width:"100%",height:"100%",src:l(i).creator.backgroundUrl},null,8,["src"])]),t("span",aa,C(l(i).creator.nickname),1)]),t("div",ta,[ra,a(l(te),{text:l(i).description},null,8,["text"]),a(l(L),{name:"arrow"})])])]),t("div",na,[t("div",null,[a(l(L),{name:"like-o"}),t("span",null,C(l(i).playCount/1e4^0)+"\u4E07",1)]),t("div",null,[a(l(L),{name:"smile-comment-o"}),t("span",null,C(l(i).commentCount),1)]),t("div",null,[a(l(L),{name:"guide-o"}),t("span",null,"\u5206\u4EAB"+C(l(i).shareCount),1)])])]))]),t("div",la,[a(l(ae),{title:"",row:20,loading:l(f)},{default:V(()=>[Object.keys(l(h)).length>0?(E(),ke(l(Oe),{key:0,loading:o.value,"onUpdate:loading":u[0]||(u[0]=d=>o.value=d),"loading-text":"\u97F3\u4E50\u5728\u8DEF\u4E0A(Vercel\u90E8\u7F72\u7684\u670D\u52A1\u5668 \u5C06\u5C31\u4E0B\u54C8)",finished:x.value,onLoad:H},{default:V(()=>[t("div",ia,[t("ul",sa,[(E(!0),N(be,null,we(l(n),(d,S)=>(E(),N("li",{class:"song-item",key:d.id,onClick:R=>l(r).push("/song/detail/"+d.id)},[t("b",da,C(Number(S)+1),1),t("div",ca,[t("h4",ua,[t("span",null,C(d.name),1),d.alia[0]?(E(),N("span",fa,"("+C(d.alia[0])+")",1)):$("",!0)]),t("p",va,[[1,2].includes(d.no)?(E(),N("span",ha,"SQ")):$("",!0),t("span",null,C(d.ar[0].name)+" - "+C(d.al.name),1)])])],8,oa))),128))])])]),_:1},8,["loading","finished"])):$("",!0)]),_:1},8,["loading"])])])]))}});var Ca=ye(ga,[["__scopeId","data-v-72d8f8db"]]);export{Ca as default};
