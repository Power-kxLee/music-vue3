import{h as M,i as l,u as Q,v as T,V as G,o as d,k as p,y as s,p as u,m as c,J as H,B as C,F as I,a0 as A,a1 as N,X as U,w as D,a2 as O,z as S,N as j,G as P,H as R,Z as X,t as Z,a3 as K}from"./vendor.97637db4.js";import{_ as W,a as m}from"./index.0117ab02.js";const h=g=>(P("data-v-3ac94117"),g=g(),R(),g),Y={class:"login"},ee={class:"loginContent"},te={key:0,class:"qr"},ae=h(()=>s("p",null,"\u626B\u7801\u4E8C\u7EF4\u7801\u767B\u5F55",-1)),se={class:"phone"},ue=h(()=>s("div",{class:"custom-button"},null,-1)),oe={key:0,class:"code"},ne=h(()=>s("div",{class:"custom-button"},null,-1)),le={class:"goform"},ce={key:0},ie={class:"more"},re=h(()=>s("mark",{class:"mark"},"\u672C\u9879\u76EE\u4EC5\u4F9B\u5B66\u4E60\u4F7F\u7528,\u8BF7\u5C0A\u91CD\u7248\u6743\uFF0C\u8BF7\u52FF\u5229\u7528\u6B64\u9879\u76EE\u4ECE\u4E8B\u5546\u4E1A\u884C\u4E3A\u6216\u8FDB\u884C\u7834\u574F\u7248\u6743\u884C\u4E3A",-1)),de=M({setup(g){const o=l({phone:"",captcha:""}),_=Q(),f=l(0),b=l(0),y=l(!1),i=l(!1),F=l("");T();const q=l(""),B=l("phone");let x;const L=function(){let t=Math.floor(o.value.phone.length/11*100);t>=100&&(t=100),f.value=t},$=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/,n=K,z=async()=>{if(i.value)return;if(!$.test(o.value.phone))return n({type:"warning",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u7801"}),!1;if(i.value=!0,!y.value){F.value="\u6B63\u5728\u53D1\u9001\u77ED\u4FE1";const e=await m.get({url:"/captcha/sent",data:o.value});return i.value=!1,e.code===200&&e.data?(n({type:"success",message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F"}),y.value=!0):n({type:"danger",message:e.message}),!1}if(o.value.captcha.length!==4)return n({type:"warning",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801"}),!1;F.value="\u6B63\u5728\u767B\u5F55\u4E2D...";const t=await m.get({url:"/login/cellphone",data:o.value}).catch(e=>{n({type:"danger",message:e.message}),i.value=!1});t.code===200?(n({type:"success",message:"\u767B\u5F55\u6210\u529F"}),_.commit("update",{key:"cookie",value:t.cookie}),k()):n({type:"danger",message:t.message})},J=async()=>{const t=new Date,{data:e}=await m.get({url:"/login/qr/key",data:{timestamp:Date.parse(t)}}),{unikey:a}=e;x=a;const w=await m.get({url:"/login/qr/create",data:{key:a,qrimg:a}}),{qrimg:E}=w.data;q.value=E},v=G(()=>(B.value==="qr"?(r.state=!1,r.start(x)):r.stop(),B.value)),V=t=>{B.value=t},k=async()=>{const t=await m.get({url:"/login/status",data:{timerstamp:Date.now()}});t.data.code===200&&(window.localStorage.setItem("loginStatus",JSON.stringify(t)),_.commit("update",{key:"loginStatus",value:t}))},r={state:!1,key:"",start:async t=>{if(r.state)return!1;const e=await m.get({url:"/login/qr/check",data:{key:t,time:Date.now()}}),{code:a,message:w,cookie:E}=e;if(a!==803)return n({type:"warning",message:w}),setTimeout(async()=>await r.start(t),2e3);n({type:"success",message:"\u767B\u5F55\u6210\u529F"}),_.commit("update",{key:"cookie",value:E}),k()},stop:()=>{r.state=!0}};return J(),k(),(t,e)=>(d(),p("article",Y,[s("main",null,[s("div",ee,[u(v)==="qr"?(d(),p("div",te,[ae,c(u(H),{width:"200",height:"200",src:q.value},null,8,["src"])])):C("",!0),u(v)==="phone"?(d(),p(I,{key:1},[s("div",se,[A(s("input",{type:"tel","onUpdate:modelValue":e[0]||(e[0]=a=>o.value.phone=a),onInput:L,max:"11",placeholder:"\u8F93\u5165\u624B\u673A\u53F7\u7801"},null,544),[[N,o.value.phone]]),c(u(U),{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),disabled:"","active-color":"#ee0a24"},{button:D(()=>[ue]),_:1},8,["modelValue"])]),y.value?(d(),p("div",oe,[A(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>o.value.captcha=a),placeholder:"\u9A8C\u8BC1\u7801",max:"4"},null,512),[[N,o.value.captcha]]),c(u(U),{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),disabled:"","active-color":"#ee0a24"},{button:D(()=>[ne]),_:1},8,["modelValue"])])):C("",!0),s("div",le,[c(u(O),{class:S(["loginbtn",{nobtn:i.value}]),onClick:z},{default:D(()=>[s("div",null,[i.value?(d(),p(I,{key:1},[c(u(X),{type:"spinner",size:"24px"}),s("span",null,Z(F.value),1)],64)):(d(),p("span",ce,"\u5FEB\u901F\u767B\u5F55"))])]),_:1},8,["class"])])],64)):C("",!0),s("footer",null,[s("div",ie,[c(u(j),{onClick:e[4]||(e[4]=a=>V("phone")),class:S({cur:u(v)==="phone"}),name:"phone-o"},null,8,["class"]),c(u(j),{onClick:e[5]||(e[5]=a=>V("qr")),class:S({cur:u(v)==="qr"}),name:"scan"},null,8,["class"])])])]),re])]))}});var ge=W(de,[["__scopeId","data-v-3ac94117"]]);export{ge as default};
